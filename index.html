<!DOCTYPE html>

<html>

<head>
    <meta name="viewport" content="width=600, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="Interactive Online Fractional Derivative Playground">
    <meta name="keywords" content="Fractional,Derivative,Derivation,Derive,Interactive,Online,Playground,Integration">
    <title>Fractional Derivative Playground</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="index.js"></script>
    <script>
        function main() {
            window.onresize = update;
            update();
            for (const input of document.getElementsByTagName("input"))
                input.oninput = update;
            for (const input of document.getElementsByTagName("select"))
                input.oninput = update;
        }
        function update() {
            // UI
            const ctrlHeight = document.getElementById("controls").scrollHeight + "px";
            document.getElementById("render_target").style.height = document.getElementById("controls").style.top = "calc(100% - " + ctrlHeight + ")";


            const min = +document.getElementById("inp_xmin").value;
            document.getElementById("inp_xmin").style.background = isNaN(min) ? "#FCC" : null;
            const max = +document.getElementById("inp_xmax").value;
            document.getElementById("inp_xmax").style.background = isNaN(max) ? "#FCC" : null;
            const step = (max - min) / 128;

            const userAlpha = +document.getElementById("inp_alpha").value;
            document.getElementById("out_alpha").innerText = userAlpha;
            // const fs = alphas.map(alpha => derivate(x => x * x, alpha, 0));

            // for (let x = min; x <= max; x += step)
                // values.push([x].concat(fs.map(f => f(x))));

            render();
        }
        // source: https://stackoverflow.com/questions/36721830/convert-hsl-to-rgb-and-hex
        function hslToHex(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;
            let r, g, b;
            if (s === 0) {
                r = g = b = l; // achromatic
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1 / 6) return p + (q - p) * 6 * t;
                    if (t < 1 / 2) return q;
                    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1 / 3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1 / 3);
            }
            const toHex = x => {
                const hex = Math.round(x * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }
        const lift = 10;
        function renderValue(ctx, x, y, dx, dy, v, maxVal) {
            const color = v > 0 ? hslToHex(240, 100, 100 - Math.pow(v / maxVal, 1/lift) * 50) : hslToHex(360, 100, 100 - Math.pow(-v / maxVal, 1/lift) * 50);
            ctx.fillStyle = color;
            ctx.fillRect(x - dx / 2, y, dx, dy);
        }
        function render() {
            const rt = document.getElementById("render_canvas");
            rt.width = rt.clientWidth;
            rt.height = rt.clientHeight;
            const ctx = rt.getContext("2d");
            ctx.translate(rt.width / 2, 0);

            const fac = 0.4;
            const f = x => Math.exp(-x * x * Math.PI * fac * fac) * fac;
            const maxY = 30;
            const dx = 0.1;
            const dy = 0.1;
            const maxX = rt.width * dy / 2;
            const maxValue = getCoeffs(maxY, maxY).reduce((a,b) => Math.max(a,b), 0);
            ctx.scale(1/dy, 1/dy);
            for (let y = 0; y <= maxY; y += dy) {
                const ff = derivate(f, y);
                for (let x = -maxX; x <= maxX; x += dx)
                    renderValue(ctx, x, y, dx, dy, ff(x), maxValue);
            }
            ctx.globalAlpha = 0.5;
            // for (let y = 0; y <= maxY; y += dy) {
            for (let y = maxY; y <= maxY + 1; y += dy) {
                const vs = getCoeffs(y, 100);
                for (let x = 0; x < vs.length; ++x)
                    renderValue(ctx, x - y/2, y, 1, dy, vs[x], maxValue);
            }
            console.log("done");
        }
    </script>
    <style>
        body {
            padding: 0;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif
        }

        * {
            font-size: inherit;
        }

        #controls>span:first-child * {
            font-family: inherit;
            margin-bottom: 0.3rem;
        }

        #controls>span:first-child {
            font-family: 'Courier New', Courier, monospace;
            font-size: 2rem;
            display: inline-block;
            vertical-align: top;
            margin-left: 2em;
            padding: 1rem;
            min-width: 18em;
        }

        #controls>span:last-child {
            font-size: 1rem;
            display: inline-block;
            margin-left: 1em;
            vertical-align: top;
            padding: 1em;
            margin: auto;
        }

        #controls {
            width: 100%;
            position: fixed;
            top: calc(100% - 80px);
            text-align: left;
            background: lightgray;
            display: flex;
            flex-flow: row;
        }

        #render_target {
            width: 100%;
            height: calc(100% - 80px);
            position: fixed;
        }

        @media only screen and (max-width: 1100px) {
            #controls>span:first-child {
                font-size: 1.5rem;
            }
            #controls>span:last-child {
                font-size: 0.85rem;
            }
        }

        @media only screen and (max-width: 800px) {
            #controls {
                flex-direction: column;
            }
            #controls>span:first-child {
                font-size: 1rem;
            }
            #controls>span:last-child {
                font-size: 0.7rem;
            }
        }
    </style>
</head>

<body onload="main()">
    <div id="render_target">
        <canvas id="render_canvas" style="display: relative; left: 0; top: 0; width: 100%; height: 100%">

        </canvas>
    </div>
    <div id="controls">
        <span>
            <span>&nbsp;&nbsp;&nbsp;α =
                <input id="inp_alpha" type="range" style="width: 10em" min="0" max="4" value="0.5" step="0.1">
                <span id="out_alpha"></span>
            </span>
            <br>
            <span>
                <input id="inp_xmin" type="text" style="width: 3em; text-align: right" value="-5"> ≤ x ≤
                <input id="inp_xmax" type="text" style="width: 3em" value="5">
            </span>
            <br>
        </span>
    </div>
</body>

</html>
